define("fusion/b-share/b-share",["require","fusion/deps/fusion.best","fusion/deps/detect","fusion/b-popup/b-popup","fusion/b-toast/b-toast","fusion/deps/aio"],function(e){function t(e,o){var n="";n="/sf"===window.location.pathname?t.getSfDom(e):t.getSigamDom(e),t.createRequest(n,e,o)}var o=e("fusion/deps/fusion.best"),n=e("fusion/deps/detect");e("fusion/b-popup/b-popup"),e("fusion/b-toast/b-toast");e("fusion/deps/aio");var i=$('<style data-for="fusion/b-share"></style>')
;i.text(".b-share-popup-wrapper{z-index:900}.b-share-popup-mask{display:none;position:fixed;left:0;top:0;opacity:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:901}.b-share-popup-modal{display:none;position:fixed;left:0;width:100%;background-color:#f1f1f1;z-index:902;margin:0;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.b-share-popup-head{display:none;font-size:18px;margin:10px 26px}.b-share-popup-title{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.b-share-popup-remove{line-height:17px;position:absolute;right:8px;top:10px}.b-share-popup-content{text-align:center;margin:0 auto;padding-top:20px;}"),
$("head").append(i);var a,r=function(e,t){var o=this;o.options=$.extend({title:"",content:"",fullView:!1,duration:400,customClassName:"",onOpen:function(){},onClose:function(){}},t),o._init(e)};r.prototype={constructor:r,version:"0.0.1",_init:function(e){var t=this;t._preparePopupWrapper(e),t._stopScroll(),t.popup()},_preparePopupWrapper:function(e){var t=this;$(".b-share-popup-wrapper").detach(),t.$popupFrame=$('<div class="b-share-popup-wrapper"></div>'),e.append(t.$popupFrame)},
_stopScroll:function(){this.$popupFrame.on("touchmove",function(e){e.preventDefault()})},_bindEvent:function(){var e=this;window.page&&page.on&&page.on("destroy",function(){t.clearData()}),e.$popupFrame.on("click",".b-share-popup-mask,.b-share-popup-remove",function(){e.closePopup()})},_randerContent:function(){var e=this;if(e.$popupMask=$('<div class="b-share-popup-mask"></div>'),e.$popupModal=$('<div class="b-share-popup-modal"></div>'),
e.$popupContent=$('<div class="b-share-popup-content"></div>'),e.$popupHead=$('<div class="b-share-popup-head"></div>'),e.options.title){var t=$('<div class="b-share-popup-title"></div>');t.append(e.options.title),e.$popupHead.append(t)}var o=$('<div class="b-share-popup-remove c-icon">&#xe61a</div>');e.$popupHead.append(o),e.$popupContent.append(e.options.content),e.$popupModal.append(e.$popupHead).append(e.$popupContent).addClass(e.options.customClassName),
e.$popupFrame.append(e.$popupModal).append(e.$popupMask)},popup:function(){var e=this,t=$(window).height();e._randerContent(),e._bindEvent(),e.$popupMask.height(t).show().animate({opacity:1},"fast","ease"),e.$popupModal.css("top",t).show();var o=e.$popupModal.height();(e.options.fullView||o>t)&&e.$popupModal.height(t),e.$popupModal.animate({"-webkit-transform":"translate3d(0, -100%, 0)",transform:"translate3d(0, -100%, 0)"},e.options.duration,"ease",function(){e.options.onOpen()})},
closePopup:function(){var e=this;e.$popupModal.animate({"-webkit-transform":"translate3d(0, 0, 0)",transform:"translate3d(0, 0, 0)"},e.options.duration,"ease",function(){$(this).hide(),e.options.onClose(),e._destroy()}),e.$popupMask.animate({opacity:0},"fast","ease",function(){$(this).hide()}),t.clearData()},_destroy:function(){var e=this;e.$popupFrame.off("click",".b-share-popup-mask,.b-share-popup-remove"),e.$popupFrame.empty()}}
;var s=n.os,p=n.browser,c="zbios"!==p.n||"ios"===n.os.n&&navigator.userAgent.indexOf("baiduboxapp/0_01.0.4.8")>-1?0:1,l="uc"!==p.n||"undefined"==typeof ucweb&&"undefined"==typeof ucbrowser?0:1,u="qq"===p.n&&p.v&&p.v>"5.4"?1:0,d="wechat"===p.n?1:0,h=Box&&Box.version&&parseFloat(Box.version),f=$.Deferred();if(u){var b=document.createElement("script");b.type="text/javascript",b.onload=b.onreadystatechange=function(){
this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||f.resolve()},b.src="//jsapi.qq.com/get?api=app.share",$("head").append(b)}var m,g=function(e,t){t&&(e.url=encodeURIComponent(e.url),e.linkUrl=encodeURIComponent(e.url)),Box.os.android?Box.android.invokeApp("Bdbox_android_utils","callShare",[JSON.stringify(e),window.successFnName||"console.log",window.errorFnName||"console.log"]):Box.ios.invokeApp("callShare",{options:encodeURIComponent(JSON.stringify(e)),
errorcallback:"onFail",successcallback:"onSuccess"})},v=function(e,t){var o={sinaweibo:["kSinaWeibo","SinaWeibo",11,"新浪微博"],wxfriend:["kWeixin","WechatFriends",1,"微信好友"],pyq:["kWeixinFriend","WechatTimeline","8","微信朋友圈"],qqfriend:["kQQ","QQ","4","QQ好友"],qzone:["kQZone","QZone","3","QQ空间"]},n=t.url,i=t.title;t.content;e=""===e?"":"ios"===s.n?o[e][0]:o[e][1],
"undefined"!=typeof ucweb?ucweb.startRequest("shell.page_share",[i,i,n,e,"","@",""]):"undefined"!=typeof ucbrowser&&ucbrowser.web_share(i,i,n,e,"","@","")},y=function(e,t){var o={sinaweibo:["kSinaWeibo","SinaWeibo",11,"新浪微博"],wxfriend:["kWeixin","WechatFriends",1,"微信好友"],pyq:["kWeixinFriend","WechatTimeline","8","微信朋友圈"],qqfriend:["kQQ","QQ","4","QQ好友"],qzone:["kQZone","QZone","3","QQ空间"]};e=""===e?"":o[e][2];var n={url:t.url,title:t.title,description:t.content,img_url:"",img_title:"",to_app:e,
cus_txt:"请输入此时此刻想要分享的内容"};n=""===e?"":n,$.when(f).done(function(){"undefined"!=typeof browser&&void 0!==browser.app&&browser.app.share(n)})},w=function(){$(".b-share-wechat-tips").length?$(".b-share-wechat-tips").show():($("body").append($('<div class="b-share-wechat-tips"></div>')),$(".b-share-wechat-tips").on("click",function(){$(this).hide(),clearTimeout(m)})),m=setTimeout(function(){$(".b-share-wechat-tips").hide(),clearTimeout(m)},2e3)},x=function(e){
var t=$.Deferred(),o="http://mysearch.pae.baidu.com/api/s";return"https:"===window.location.protocol&&(o="https://sp0.baidu.com/5LMDcjW6BwF3otqbppnN2DJv/mysearch.pae.baidu.com/api/s"),$.ajax({url:o,type:"GET",timeout:1e3,dataType:"jsonp",jsonp:"cb",data:{params:JSON.stringify([e])}}).done(function(o){o&&"0"===o.status&&o[e]?t.resolve(o[e]):t.resolve(e)}).fail(function(){t.resolve(e)}),t.promise()},k=function(e){var t=this;$.when(x(e)).then(function(e){
var o="b-share-copytip-cancel-btn-"+Date.now(),n="b-share-copytip-link-"+Date.now(),i=['<div class="b-share-copytip-content">','<div class="b-share-copytip-text">长按复制下方链接，去粘贴给好友吧：</div>','<div class="b-share-copytip-linkwr"><a class="b-share-copytip-link '+n+'" href="'+e+'" target="_blank">'+e+"</a></div>","</div>",'<div class="b-share-copytip-cancel-btn '+o+'">取消</div>'].join(""),a=new r($("body"),{content:i,fullView:!1,onClose:function(){t.trigger("close")}});$("."+o).on("click",function(){
a.closePopup()}),$("."+n).on("click",function(){return!1})})},S={key:"pyq",icon:"//m.baidu.com/se/static/pmd/pmd/share/images/pyq_2.png",title:"朋友圈",cb:function(){return c?function(e){e.mediaType="weixin_timeline",g(e,!1)}:l?function(e){v("pyq",e)}:u?function(e){y("pyq",e)}:d?function(e){w()}:function(e){k.call(this,e.url)}}()},q={key:"wxfriend",icon:"//m.baidu.com/se/static/pmd/pmd/share/images/wxfriend_2.png",title:"微信好友",cb:function(){return c?function(e){e.mediaType="weixin_friend",g(e,!1)
}:l?function(e){v("wxfriend",e)}:u?function(e){y("wxfriend",e)}:d?function(e){w()}:function(e){k.call(this,e.url)}}()},_={key:"qqfriend",icon:"//m.baidu.com/se/static/pmd/pmd/share/images/qqfriend_2.png",title:"QQ好友",cb:function(){return c?function(e){e.mediaType="qqfriend",g(e,!1)}:l?function(e){v("qqfriend",e)}:u?function(e){y("qqfriend",e)}:function(e){k.call(this,e.url)}}()},C={key:"qzone",icon:"//m.baidu.com/se/static/pmd/pmd/share/images/qzone_2.png",title:"QQ空间",cb:function(){
return c?function(e){e.mediaType="qqdenglu",g(e,!1)}:l&&"ios"===s.n?function(e){v("qzone",e)}:u?function(e){y("qzone",e)}:function(e){var t="url="+encodeURIComponent(e.url)+"&imageUrl="+encodeURIComponent(e.iconurl)+"&summary="+e.content+"&title="+e.title;window.open("http://qzs.qzone.qq.com/open/connect/widget/mobile/qzshare/index.html?"+t)}}()},M={key:"sinaweibo",icon:"//m.baidu.com/se/static/pmd/pmd/share/images/sinaweibo_2.png",title:"新浪微博",cb:function(){return c?function(e){
e.mediaType="sinaweibo",g(e,!1)}:l?function(e){v("sinaweibo",e)}:u?function(e){y("sinaweibo",e)}:function(e){window.open("http://v.t.sina.com.cn/share/share.php?url="+encodeURIComponent(e.url)+"&title="+encodeURIComponent(e.title))}}()},T={key:"more",icon:"//m.baidu.com/se/static/pmd/pmd/share/images/more_2.png",title:"更多",cb:function(){var e;return c?e=function(e){e.mediaType="all",g(e,!1)}:l?e=function(e){v("",e)}:u&&(e=function(e){y("",e)}),e}()},D=o("b-share",{
css:"/* 分享列表容器 */.b-share-list {  overflow: hidden;}.b-share-list .c-flexbox:not(:first-of-type) {  margin-top: 12px;}.b-share-list .b-share-btn {  width: 50px;  -webkit-box-flex: 1;  -webkit-flex: 1 1 auto;  color: #666;  text-align: center;  font-size: 13px;  line-height: 1;}.b-share-list .b-share-btn .c-img {  max-width: 50px;  margin: 0 auto;  background: #fff;  border: 1px solid #f0f0f0;  border-radius: 50%;}/* 分享取消按钮,只在popup打开时展现 */.b-share-cancel-btn,.b-share-copytip-cancel-btn {  width: 100%;  margin-top: 20px;  color: #333;  font-size: 16px;  line-height: 48px;  background: #f8f8f8;  border-top: #eaeaea 1px solid;}/* 微信分享提示tips */.b-share-wechat-tips {  position: fixed;  top: 0;  left: 0;  z-index: 999;  width: 100%;  height: 100%;  background: rgba(0, 0, 0, 0.6) url(//m.baidu.com/se/static/pmd/pmd/share/images/wxtips.png) right 32px top 10px no-repeat;  background-size: 50%;}.b-share-list .b-share-btn {  width: 60px;  font-size: 11px;}.b-share-list .b-share-btn .c-img {  max-width: 60px;}.b-share-list .c-flexbox:not(:first-of-type) {  margin-top: 28px;}/* 复制链接提示 */.b-share-copytip-content {  padding: 0 20px;  color: #333;  text-align: left;}.b-share-copytip-text {  font-size: 16px;  margin-bottom: 10px;}.b-share-copytip-linkwr {  padding: 7px 10px;  font-size: 14px;  line-height: 21px;  border: 1px dotted #d9d9d9;  word-break: break-all;}.b-share-copytip-link:visited,.b-share-copytip-link {  color: #333;}/*增加提交框样式*/.b-share-screenshot-wrapper {  display: none;}/*截图分享tip*/.b-share-toastbox {  z-index: 950;  width: 1.4rem;  height: .50rem;  font-size: .18rem;  color: #ffffff;  border: 1px solid #000;  border-radius: .04rem;  padding: 0;  line-height: .50rem;  text-align: center;  background-color: #000000;  opacity: .8;  filter: alpha(opacity=80);  position: absolute;  left: 0;  right: 0;  top: -0.56rem;  margin: 0 auto;  display: none;}",
tpl:"",props:{usePopup:{type:Boolean,value:!1},url:{type:String,value:function(){return window.location.href},onChange:function(){this.updateShareData()}},title:{type:String,value:"百度搜索有惊喜",onChange:function(){this.updateShareData()}},content:{type:String,value:"",onChange:function(){this.updateShareData()}},iconurl:{type:String,value:"https://m.baidu.com/se/static/pmd/pmd/share/images/bdu.jpg",onChange:function(){this.updateShareData()}},color:{type:String,value:"#666"},channel:{type:Array,
value:["wxfriend","pyq","qqfriend","qzone","sinaweibo","more"]},loginfo:{type:Object,value:{}},custom:{type:Array,value:[]},type:{type:String,value:"url",onChange:function(){this.updateShareData()}},screenshot:{type:String,value:"",onChange:function(){this.updateShareData()}},imageurl:{type:String,value:"",onChange:function(){this.updateShareData()}}},title:null,url:null,linkUrl:null,content:null,iconurl:null,custom:null,list:null,listHTML:null,loginfo:null,sharePopup:null,type:null,
screenshot:null,imageurl:null,callNativeShare:!1,init:function(){var e=this,t=$(this.element),o=this.getProp();if(this.updateShareData(),c&&!this.isLongScreenShot())return void(this.callNativeShare=!0);var n={"#333":"c-color","#999":"c-color-gray","#666":""},i=n[o.color],a={wxfriend:q,pyq:S,qzone:C,sinaweibo:M,qqfriend:_};this.custom=o.custom;var r=[];for(var p in a)a.hasOwnProperty(p)&&-1!==$.inArray(p,o.channel)&&r.push(a[p])
;(c||l||u&&"ios"===s.n)&&$.inArray("more",this.getProp("channel"))>-1&&r.push(T);var d=r[r.length-1];if(o.custom.length>0&&"more"===d.key){var h=r.pop();r=r.concat(o.custom),r.push(h)}else r=r.concat(o.custom);this.list=r;var f="";if("array"===$.type(r)&&r.length>0){f+='<div class="b-share-list">';for(var b=r.length,m=Math.ceil(b/4),g=0;g<m;g++){f+='<div class="c-flexbox">';for(var v=0;v<4;v++){var y=4*g+v,w=r[y];(w||b>4)&&(f+='<div class="b-share-btn">'),
w&&(f+='<img class="c-img" src="'+w.icon+'" />',f+='<div class="c-gap-top c-line-clamp1 '+i+'">'+w.title+"</div>"),(w||b>4)&&(f+="</div>")}f+="</div>"}f+="</div>"}this.listHTML=f,o.usePopup||t.append(f),e._bindEvent()},updateShareData:function(){var e=this.getProp();this.title=e.title,this.loginfo=e.loginfo,this.iconurl=e.iconurl,this.usePopup=e.usePopup,this.type=e.type,"screenShot"===e.type&&e.screenshot&&(this.screenshot=JSON.parse(e.screenshot)),
"image"===e.type&&e.imageurl&&(this.imageurl=e.imageurl);var t="image"===e.type||"screenShot"===e.type,o=c&&"ios"===n.os.n&&h>=9,i=c&&"android"===n.os.n&&h>=9.1;!t||o||i||(this.type="url"),e.content||(e.content=e.title),this.content=e.content,/^\/\/.+/.test(e.url)&&(e.url="http:"+e.url),this.linkUrl=this.url=e.url},getShareData:function(){var e={url:this.url,linkUrl:this.linkUrl,title:this.title,content:this.content,iconurl:this.iconurl}
;return"image"===this.type&&(e.type=c&&"ios"===n.os.n?"image":3,e.imageUrl=this.imageurl),"screenShot"===this.type&&this.screenshot&&(e.screenshot=this.screenshot),e},_bindEvent:function(){var e=this,o=$(this.element),i=this.title;o.on("click",".b-share-btn",function(){var a=e.getShareData(),r=o.find(".b-share-btn").index($(this));if(e.list[r]){var s=e.list[r];if(e.callbackFn&&e._custom(s))return void e.callbackFn(s.key);if("screenShot"===e.type){
var p=e.screenshot,l="&sa=oa_si&resourceid="+p.resourceId;if(p.linkUrl=a.url+l,a.content="",a.type=c&&"ios"===n.os.n?"image":3,""!==t.imageUrl)a.imageUrl=t.imageUrl,s.cb&&s.cb(a),e._sendLog(s.key),e.trigger("shareClick",{key:s.key,index:r}),e.close();else{if(t.btnLock)return;t.btnLock=!0,t(p,function(o){t.btnLock=!1,a.imageUrl=o,$.when(x(p.linkUrl)).then(function(t){i===a.title&&(a.title+=" "+t),s.cb&&s.cb(a),e._sendLog(s.key),e.trigger("shareClick",{key:s.key,index:r}),e.close(),s=null})})}
}else s.cb&&s.cb.call(e,a),e._sendLog(s.key),e.trigger("shareClick",{key:s.key,index:r}),e.close()}}),o.on("click",".b-share-cancel-btn",function(){e.close()})},_sendLog:function(e){var t=this,o={pyq:{ct:40,cst:2},wxfriend:{ct:40,cst:1},qqfriend:{ct:40,cst:5},qzone:{ct:40,cst:3},sinaweibo:{ct:40,cst:4},more:{ct:40,cst:9},close:{ct:40,cst:0}};if(e&&o[e]&&"object"==typeof page&&page.log&&page.log.send){var n=o[e];n=$.extend(n,t.loginfo),page.log.send(n)}},_custom:function(e){
return this.custom.filter(function(t){return e.key===t.key},this).length>0},popup:function(e){if(this.callNativeShare){var t=this.getShareData();return t.mediaType="all",g(t,!1),void this.trigger("close")}if(this.usePopup){a=e;var o=this.supportCraft();if(o.support)return void this.searchCraft(o.os);var n=this,i=$(this.element);this.sharePopup=new r(i,{content:this.listHTML+'<div class="b-share-cancel-btn">取消</div>',fullView:!1,onClose:function(){n.trigger("close")}})}},close:function(){
this.usePopup&&this.sharePopup&&this.sharePopup.closePopup()},qqShare:y,searchCraft:function(e){this.trigger("close");var o=this.screenshot,n={func:"callNativeShare",options:{type:o?"image":"url",imgurl:"",title:this.title,url:this.url||window.location.href}};o?(o.templateMode="noseacherbar",o.linkUrl=this.url||window.location.href,t.bToast("open"),t(o,function(t){n.options.imgurl=t,e&&(n=JSON.stringify(n)),window.Viaduct.postMessage(n)})):(n.options.imgurl=this.iconurl,
n.options.describe=this.content,n.options.url=this.url||window.location.href,e&&(n=JSON.stringify(n)),window.Viaduct.postMessage(n))},supportCraft:function(){var e="undefined"!=typeof navigator?navigator.userAgent:"",t=/SearchCraft/i.test(e),o=/Android/i.test(e),n=t&&e.match(/SearchCraft\/([\d.]*)/),i=o&&parseFloat(n[1])>1.5,a=!o&&parseFloat(n[1])>1.11;return{os:o,support:t&&(i||a)}},isLongScreenShot:function(){return"screenShot"===this.type&&"/sf"===window.location.pathname}})
;return t.imageUrl="",t.btnLock=!1,t.getSigamDom=function(e){var t="";$("style").not(function(e,t){return 0!==$(this).parents('div[id="results"]').length}).each(function(){t+=$(this).get(0).outerHTML});var o=$(".c-result[tpl="+e.screenshotCard+"]");/SearchCraft/i.test("undefined"!=typeof navigator?navigator.userAgent:"")&&(t+="<style>.c-sigma-wapper{padding-top:0}</style>");var n=o.find(".c-recomm-wrap");n.length>0&&n.remove();var i=e.shareBotton,a=i?o.find("."+i):[];a.length>0&&a.remove()
;var r=(t+o.get(0).outerHTML).replace(/'/g,"27%");return $(".b-share-popup-wrapper").length>0&&(r=r.replace($(".b-share-popup-wrapper").get(0).outerHTML,"")),r},t.getSfDom=function(e){var t=document.createElement("div"),o=$(a).closest(".sfa-view"),n=o.get(0).outerHTML;t.innerHTML=n,t.style.minHeight=0;var i=t.querySelector(".sfa-head"),r=t.querySelector(".sfa-body"),s=t.querySelector(".sfa-top-results"),p=s&&s.querySelector("div[data-tpl ='top_nav']"),c=t.querySelector("b-share");if(i){
i.style.position="relative";var l=i.querySelector(".sfa-back"),u=i.querySelector(".sfa-tool");l&&i.removeChild(l),u&&i.removeChild(u)}if(r&&(r.style.paddingTop="0"),p&&(p.style.position="relative",p.style.top="0"),e.templateLen){var d=Number(e.templateLen)-1;$(t).find(".c-result").each(function(e,t){e>d&&$(t).remove()})}$(c).remove();var h="";$("head").find("style").each(function(){h+=$(this).get(0).outerHTML});return h+t.innerHTML+"<style>body{background:#333237 !important;}</style>"},
t.createRequest=function(e,o,n){"noseacherbar"===o.templateMode?(o.templateMode="qingjingye",o.searchBar=1):o.searchBar=0;var i={word:o.word,template_mode:o.templateMode,render_dom:e,resource_id:o.resourceId,target_url:o.linkUrl,expression:o.expression,no_search_bar:o.searchBar};$.ajax({url:"https://sp2.baidu.com/-bkZdDe71MgUo2bgoI7O1ygwehsv/goshare/pageshot/official",type:"post",data:i,timeout:6e3,beforeSend:function(){t.insert(),t.tip("loadding")},success:function(e){t.bToast("close"),
t.tip("ok");var o=JSON.parse(e);t.imageUrl=o.data.url,n(o.data.url)},error:function(e){t.bToast("error"),t.btnLock=!1,t.tip("error",3)}})},t.tip=function(e,t){if("loadding"===e)$(".b-share-loading-toast").show();else if("ok"===e)$(".b-share-loading-toast").hide();else{$(".b-share-loading-toast").hide(),$(".b-share-fail-toast").show();var o=1e3*Number(t);setTimeout(function(){$(".b-share-fail-toast").hide()},o)}},t.insert=function(){
if(1!==$(".b-share-screenshot-wrapper").length&&0!==$(".b-share-popup-modal").length){$(".b-share-popup-modal").append('<div class="b-share-loading-toast b-share-toastbox">正在加载</div><div class="b-share-fail-toast b-share-toastbox">分享失败</div>')}},t.clearData=function(){$(".b-share-loading-toast").remove(),$(".b-share-fail-toast").remove(),t.imageUrl=""},t.bToast=function(e){$(".b-share-toast").length||$("body").append('<b-toast class="b-share-toast" msg="正在加载" autoClose="false"></b-toast>')
;var t=$(".b-share-toast").get(0);"open"===e?t.fusionReady=function(){t.fusion.open()}:"error"===e?t.fusion.open({msg:"分享失败",autoClose:!0}):t.remove()},D});